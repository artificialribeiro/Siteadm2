<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PDV - Boutique Diniz</title>
    <link rel="icon" href="logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { 'brand-black': '#000000', 'brand-dark': '#0A0A0A', 'brand-gray': '#141414', 'brand-border': '#27272A' },
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['Roboto Mono', 'monospace'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- AMBOS os estilos de ícone: padrão (menu.js usa) + outlined (pdv usa) -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #000000; color: #FFFFFF; overflow: hidden; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .input-dark { width: 100%; background: #0A0A0A; border: 1px solid #27272A; color: white; padding: 0.75rem 1rem; border-radius: 0.75rem; outline: none; transition: all 0.2s; font-family: inherit; }
        .input-dark:focus { border-color: #fff; }
        select.input-dark option { background: #0A0A0A; }
        /* Sidebar do menu.js não quebra o flex do body */
        #sidebar { flex-shrink: 0; }
        /* Cupom térmico 80mm */
        @media print {
            @page { margin: 0; size: 80mm auto; }
            html, body { height: auto !important; overflow: visible !important; background: white !important; }
            body * { visibility: hidden; }
            #modal-recibo, #modal-recibo * { visibility: visible !important; color: black !important; }
            #modal-recibo {
                position: fixed !important; inset: 0 !important;
                width: 80mm !important; height: auto !important;
                max-height: none !important; background: white !important;
                border: none !important; border-radius: 0 !important;
                display: block !important; overflow: visible !important;
                box-shadow: none !important; padding: 0 !important; margin: 0 !important;
            }
            #modal-recibo > div { width: 80mm !important; max-height: none !important; border: none !important; border-radius: 0 !important; overflow: visible !important; }
            .no-print { display: none !important; visibility: hidden !important; }
            #area-impressao-cupom { width: 72mm !important; margin: 0 4mm !important; padding: 2mm 0 !important; font-family: 'Courier New', monospace !important; font-size: 8pt !important; line-height: 1.3 !important; }
        }
    </style>
</head>
<body class="flex h-screen w-screen overflow-hidden selection:bg-white selection:text-black relative">

    <!-- Barra de erro global -->
    <div id="error-console" class="fixed top-0 left-0 w-full z-[999] bg-red-600 text-white px-4 py-2 text-xs font-mono hidden items-center justify-between shadow-xl">
        <div class="flex items-center gap-2"><span class="material-icons-outlined text-sm">report_problem</span><span id="error-message"></span></div>
        <button onclick="this.parentElement.classList.add('hidden')" class="hover:bg-red-700 px-2 py-1 rounded">✕</button>
    </div>

    <!-- menu.js injeta #sidebar aqui via insertAdjacentHTML afterbegin -->

    <main class="flex-1 flex h-full overflow-hidden min-w-0 relative">

        <!-- ==================== ÁREA DE PRODUTOS ==================== -->
        <section class="flex-1 flex flex-col h-full bg-brand-black min-w-0">

            <!-- HEADER -->
            <header class="h-14 shrink-0 border-b border-brand-border bg-brand-black flex items-center gap-2 px-3 sm:px-5">
                <!-- Botão menu -->
                <button id="btn-open-menu" class="text-gray-400 hover:text-white transition-colors shrink-0">
                    <span class="material-icons">menu</span>
                </button>
                <!-- Logo / Caixa info -->
                <div class="shrink-0 hidden sm:block">
                    <p class="font-bold tracking-[0.15em] uppercase text-[10px] text-white leading-none">Boutique Diniz</p>
                    <p class="text-[9px] text-gray-500 font-mono flex items-center gap-1 mt-0.5">
                        <span id="status-caixa-badge" class="w-1.5 h-1.5 rounded-full bg-red-500 inline-block shrink-0"></span>
                        <span id="display-id-caixa">Sem caixa</span>
                    </p>
                </div>
                <!-- Campo de busca central -->
                <div class="flex-1 relative mx-1 sm:mx-3">
                    <span class="material-icons-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-[18px]">search</span>
                    <input type="text" id="input-busca-pdv" autocomplete="off" autofocus
                        class="w-full bg-brand-dark border border-gray-800 focus:border-white text-white text-sm pl-9 pr-3 py-2 rounded-full outline-none transition-all placeholder:text-gray-600"
                        placeholder="Buscar produto ou bipar código...">
                </div>
                <!-- Ações desktop -->
                <div class="hidden lg:flex items-center gap-2 shrink-0">
                    <button id="btn-abrir-lancamento" class="text-[11px] text-gray-400 hover:text-white font-medium px-2 transition-colors">Lançamento</button>
                    <button id="btn-abrir-devolucao" class="text-[11px] text-gray-400 hover:text-white font-medium px-2 transition-colors">Trocas</button>
                    <button id="btn-abrir-modal-fechar" class="px-3 py-1.5 bg-white text-black hover:bg-gray-200 rounded-full text-[10px] font-bold uppercase tracking-wider transition-colors">Fechar Caixa</button>
                </div>
                <!-- Operador -->
                <div class="hidden md:block text-right shrink-0 border-l border-brand-border pl-3">
                    <p id="topbar-user-name" class="text-[11px] font-semibold text-white tracking-wide leading-none">---</p>
                    <p class="text-[9px] text-gray-500 uppercase tracking-widest mt-0.5">Operador</p>
                </div>
                <!-- Carrinho mobile -->
                <button id="btn-toggle-cart" class="lg:hidden relative shrink-0 w-9 h-9 flex items-center justify-center text-white">
                    <span class="material-icons-outlined">shopping_bag</span>
                    <span id="cart-badge" class="absolute -top-0.5 -right-0.5 bg-red-600 text-white font-bold text-[9px] w-4 h-4 flex items-center justify-center rounded-full hidden">0</span>
                </button>
            </header>

            <!-- Grade de produtos -->
            <div class="flex-1 overflow-y-auto p-3 sm:p-4 lg:p-5">
                <div id="container-produtos"
                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3 pb-20 lg:pb-4">
                    <div class="col-span-full h-64 flex flex-col items-center justify-center text-gray-600">
                        <span class="material-icons-outlined animate-spin text-4xl mb-3 text-gray-500">sync</span>
                        <p class="text-[10px] uppercase tracking-[0.2em]">Carregando...</p>
                    </div>
                </div>
            </div>

            <!-- Barra inferior mobile -->
            <div class="lg:hidden shrink-0 border-t border-brand-border bg-brand-black flex items-center justify-around py-2 px-4">
                <button id="btn-abrir-lancamento-mob" class="flex flex-col items-center gap-0.5 text-gray-400 hover:text-white transition-colors">
                    <span class="material-icons-outlined text-xl">add_circle_outline</span>
                    <span class="text-[8px] uppercase">Lançamento</span>
                </button>
                <button id="btn-abrir-modal-fechar-mob" class="flex flex-col items-center gap-0.5 text-gray-400 hover:text-white transition-colors">
                    <span class="material-icons-outlined text-xl">lock</span>
                    <span class="text-[8px] uppercase">Fechar Caixa</span>
                </button>
                <button id="btn-abrir-devolucao-mob" class="flex flex-col items-center gap-0.5 text-gray-400 hover:text-white transition-colors">
                    <span class="material-icons-outlined text-xl">swap_horiz</span>
                    <span class="text-[8px] uppercase">Trocas</span>
                </button>
            </div>
        </section>

        <!-- ==================== PAINEL CARRINHO ==================== -->
        <aside id="painel-carrinho"
            class="fixed inset-y-0 right-0 z-40 w-full sm:w-[370px] lg:static lg:w-[390px] xl:w-[410px]
                   bg-brand-dark border-l border-brand-border flex flex-col shadow-2xl
                   transform translate-x-full lg:translate-x-0 transition-transform duration-300">

            <div class="h-14 shrink-0 border-b border-brand-border bg-brand-black flex items-center justify-between px-4">
                <h2 class="font-bold uppercase tracking-[0.15em] text-white text-sm flex items-center gap-2">
                    <span class="material-icons-outlined">local_mall</span> Sacola
                </h2>
                <div class="flex items-center gap-3">
                    <button id="btn-limpar-carrinho" class="text-[10px] text-gray-500 hover:text-red-400 uppercase tracking-wider font-semibold transition-colors">Limpar</button>
                    <button id="btn-close-cart" class="lg:hidden w-8 h-8 flex items-center justify-center bg-brand-border rounded-full text-white">
                        <span class="material-icons-outlined text-sm">close</span>
                    </button>
                </div>
            </div>

            <!-- Cliente -->
            <div class="px-3 py-2.5 border-b border-brand-border shrink-0">
                <button id="btn-abrir-busca-cliente"
                    class="w-full py-2.5 px-3 bg-brand-gray border border-brand-border rounded-xl text-xs font-medium text-gray-400 hover:text-white hover:border-gray-500 transition-all flex items-center justify-between group">
                    <span class="flex items-center gap-2"><span class="material-icons-outlined text-sm">person_add</span>Identificar Cliente</span>
                    <span class="material-icons-outlined text-sm opacity-0 group-hover:opacity-100 transition-opacity">chevron_right</span>
                </button>
                <div id="box-cliente-identificado" class="hidden items-center justify-between bg-white text-black p-2.5 rounded-xl mt-0">
                    <div class="flex items-center gap-2 min-w-0">
                        <div class="w-7 h-7 bg-black rounded-full flex items-center justify-center shrink-0">
                            <span class="material-icons-outlined text-white text-sm">person</span>
                        </div>
                        <div class="min-w-0">
                            <p id="txt-nome-cliente" class="text-xs font-bold truncate leading-tight">---</p>
                            <p id="txt-cpf-cliente" class="text-[9px] text-gray-500 font-mono leading-tight truncate">---</p>
                        </div>
                    </div>
                    <button id="btn-remover-cliente" class="w-7 h-7 flex items-center justify-center bg-gray-100 hover:bg-red-100 hover:text-red-600 rounded-full shrink-0 transition-colors">
                        <span class="material-icons-outlined text-xs">close</span>
                    </button>
                </div>
            </div>

            <!-- Lista itens -->
            <div id="lista-carrinho" class="flex-1 overflow-y-auto p-3 bg-brand-black"></div>

            <!-- Rodapé: totais + pagamento -->
            <div class="px-3 pt-3 pb-3 bg-brand-dark border-t border-brand-border shrink-0">
                <div class="flex gap-2 mb-2">
                    <div class="flex-1">
                        <label class="text-[8px] text-gray-500 font-bold uppercase tracking-widest block mb-1">Desconto R$</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-xs">R$</span>
                            <input type="number" step="0.01" min="0" id="input-desconto" class="input-dark pl-9 text-sm font-mono py-2.5" placeholder="0.00">
                        </div>
                    </div>
                    <div class="flex-1 flex flex-col justify-end">
                        <button id="btn-add-cartao" class="w-full h-[42px] bg-brand-gray border border-brand-border hover:bg-white hover:text-black text-white text-[9px] font-bold uppercase tracking-wider rounded-xl transition-all flex items-center justify-center gap-1">
                            <span class="material-icons-outlined text-sm">redeem</span> Gift Card
                        </button>
                        <div id="btn-remover-cartao" class="w-full h-[42px] bg-brand-gray border border-green-700/40 rounded-xl flex items-center justify-between px-2 hidden">
                            <span class="text-[9px] font-bold text-green-400 uppercase">Gift Card</span>
                            <div class="flex items-center gap-1">
                                <span id="txt-valor-cartao" class="text-[8px] font-mono text-gray-300"></span>
                                <button id="btn-remover-cartao-icone" class="hover:text-red-500 text-gray-500"><span class="material-icons-outlined text-sm">cancel</span></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-0.5 mb-3">
                    <div class="flex justify-between">
                        <span class="text-[10px] text-gray-500 uppercase tracking-widest">Subtotal</span>
                        <span id="subtotal-carrinho" class="text-xs font-mono text-gray-400">R$ 0,00</span>
                    </div>
                    <div id="row-desconto-display" class="hidden justify-between">
                        <span class="text-[10px] text-red-400 uppercase tracking-widest">Desconto</span>
                        <span id="display-desconto" class="text-xs font-mono text-red-400">- R$ 0,00</span>
                    </div>
                    <div id="row-gift-display" class="hidden justify-between">
                        <span class="text-[10px] text-green-400 uppercase tracking-widest">Gift Card</span>
                        <span id="display-gift" class="text-xs font-mono text-green-400">- R$ 0,00</span>
                    </div>
                    <div class="flex justify-between items-end pt-1 border-t border-brand-border mt-1">
                        <span class="text-sm font-bold text-white uppercase tracking-[0.1em]">Total</span>
                        <span id="total-carrinho" class="text-2xl sm:text-3xl font-mono text-white font-light tracking-tighter">R$ 0,00</span>
                    </div>
                </div>

                <div id="grid-pagamentos" class="grid grid-cols-4 gap-1.5">
                    <button class="btn-metodo-pgto bg-brand-gray border border-brand-border hover:bg-white hover:text-black text-white p-2 rounded-xl flex flex-col items-center justify-center gap-1 transition-all" data-tipo="dinheiro" data-label="Dinheiro">
                        <span class="material-icons-outlined text-lg">payments</span><span class="text-[7px] font-bold uppercase">Dinheiro</span>
                    </button>
                    <button class="btn-metodo-pgto bg-brand-gray border border-brand-border hover:bg-white hover:text-black text-white p-2 rounded-xl flex flex-col items-center justify-center gap-1 transition-all" data-tipo="cartao" data-label="Crédito">
                        <span class="material-icons-outlined text-lg">credit_score</span><span class="text-[7px] font-bold uppercase">Crédito</span>
                    </button>
                    <button class="btn-metodo-pgto bg-brand-gray border border-brand-border hover:bg-white hover:text-black text-white p-2 rounded-xl flex flex-col items-center justify-center gap-1 transition-all" data-tipo="cartao" data-label="Débito">
                        <span class="material-icons-outlined text-lg">credit_card</span><span class="text-[7px] font-bold uppercase">Débito</span>
                    </button>
                    <button class="btn-metodo-pgto bg-brand-gray border border-brand-border hover:bg-white hover:text-black text-white p-2 rounded-xl flex flex-col items-center justify-center gap-1 transition-all" data-tipo="pix" data-label="PIX">
                        <span class="material-icons-outlined text-lg">qr_code_scanner</span><span class="text-[7px] font-bold uppercase">PIX</span>
                    </button>
                </div>
                <div id="box-finalizar-zerado" class="hidden mt-2">
                    <button id="btn-finalizar-zerado" class="w-full bg-white text-black py-3 rounded-xl font-bold uppercase tracking-[0.1em] text-xs hover:bg-gray-200 flex items-center justify-center gap-2">
                        <span class="material-icons-outlined text-sm">check_circle</span> Concluir sem cobrança
                    </button>
                </div>
            </div>
        </aside>

        <div id="cart-overlay" class="fixed inset-0 bg-black/70 z-30 hidden lg:hidden"></div>
    </main>

    <!-- ================================================================ MODAIS ================================================================ -->

    <!-- Abrir Caixa -->
    <div id="modal-abrir-caixa" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden items-center justify-center p-4">
        <div class="bg-brand-dark w-full max-w-sm rounded-2xl border border-brand-border shadow-2xl p-7 text-center">
            <span class="material-icons-outlined text-5xl text-white mb-2 block">point_of_sale</span>
            <h3 class="text-white font-bold uppercase tracking-[0.15em] text-sm mb-1">Abrir Caixa</h3>
            <p id="info-operador-abertura" class="text-[10px] text-gray-500 mb-5"></p>
            <form id="form-abrir-caixa" class="space-y-4 text-left">
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 font-semibold tracking-widest">Troco Inicial (R$)</label>
                    <input type="number" id="c-valor-inicial" step="0.01" min="0" class="input-dark font-mono text-lg" placeholder="0.00">
                </div>
                <button type="submit" class="w-full py-4 bg-white text-black font-bold uppercase tracking-[0.1em] text-[10px] rounded-xl hover:bg-gray-200 transition-colors">Abrir Agora</button>
            </form>
        </div>
    </div>

    <!-- Fechar Caixa -->
    <div id="modal-fechar-caixa" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden items-center justify-center p-4">
        <div class="bg-brand-dark w-full max-w-sm rounded-2xl border border-red-500/30 shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-5 bg-brand-black border-b border-brand-border text-center">
                <span class="material-icons-outlined text-red-500 text-3xl block mb-1">lock</span>
                <h3 class="text-white font-bold uppercase tracking-[0.1em] text-xs">Fechar Caixa <span id="fechar-caixa-id"></span></h3>
            </div>
            <form id="form-fechar-caixa" class="p-5 space-y-4">
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 font-semibold tracking-widest">Valor Contado na Gaveta (R$)</label>
                    <input type="number" id="fc-valor-declarado" step="0.01" min="0" class="input-dark text-lg font-mono" placeholder="0.00">
                </div>
                <button type="submit" id="btn-confirmar-fechar" class="w-full py-4 bg-white text-black font-bold text-[10px] uppercase tracking-widest rounded-xl hover:bg-gray-200">Confirmar Fechamento</button>
                <button type="button" id="btn-cancelar-fechar-caixa" class="w-full py-3 bg-transparent border border-brand-border text-gray-500 text-[10px] uppercase rounded-xl hover:text-white transition-colors">Cancelar</button>
            </form>
        </div>
    </div>

    <!-- Selecionar Variante -->
    <div id="modal-selecionar-variante" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden items-center justify-center p-4">
        <div class="bg-brand-dark w-full max-w-sm rounded-2xl border border-brand-border shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-4 bg-brand-black border-b border-brand-border flex items-center gap-3">
                <img id="v-foto-produto" src="logo.png" class="w-14 h-14 rounded-xl object-cover shrink-0" onerror="this.src='logo.png'">
                <div class="min-w-0">
                    <p class="text-[9px] text-gray-500 uppercase tracking-widest mb-0.5">Selecione a variante</p>
                    <p id="v-nome-produto" class="text-sm font-bold text-white uppercase truncate"></p>
                    <p id="v-preco-produto" class="text-xs font-mono text-gray-300 mt-0.5"></p>
                </div>
                <button id="btn-fechar-variantes" class="ml-auto text-gray-500 hover:text-white shrink-0"><span class="material-icons-outlined">close</span></button>
            </div>
            <div id="lista-variantes-pdv" class="flex-1 overflow-y-auto p-3 space-y-2"></div>
        </div>
    </div>

    <!-- Identificar Cliente -->
    <div id="modal-cliente" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden items-center justify-center p-4">
        <div class="bg-brand-dark w-full max-w-sm rounded-2xl border border-brand-border shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-4 bg-brand-black border-b border-brand-border flex justify-between items-center">
                <h3 class="text-white font-bold uppercase tracking-[0.1em] text-xs">Identificar Cliente</h3>
                <button id="btn-fechar-modal-cliente" class="text-gray-500 hover:text-white"><span class="material-icons-outlined">close</span></button>
            </div>
            <div class="flex border-b border-brand-border shrink-0">
                <button id="tab-cliente-avulso" class="flex-1 py-3 text-[10px] font-bold uppercase tracking-widest bg-white text-black transition-colors">Avulso</button>
                <button id="tab-buscar-api" class="flex-1 py-3 text-[10px] font-bold uppercase tracking-widest text-gray-400 transition-colors">Buscar CPF</button>
            </div>
            <div id="content-cliente-avulso" class="p-5 space-y-3 overflow-y-auto">
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">Nome *</label>
                    <input type="text" id="avulso-nome" class="input-dark" placeholder="Nome completo">
                </div>
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">CPF (para PIX)</label>
                    <input type="text" id="avulso-cpf" class="input-dark font-mono" placeholder="000.000.000-00" maxlength="14">
                </div>
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">E-mail</label>
                    <input type="email" id="avulso-email" class="input-dark" placeholder="email@exemplo.com">
                </div>
                <button id="btn-confirmar-avulso" class="w-full py-3.5 bg-white text-black font-bold uppercase text-[10px] rounded-xl hover:bg-gray-200">Confirmar</button>
            </div>
            <div id="content-buscar-api" class="p-5 space-y-3 hidden overflow-y-auto">
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">CPF do Cliente</label>
                    <input type="text" id="busca-cpf" class="input-dark font-mono" placeholder="000.000.000-00" maxlength="14">
                </div>
                <button id="btn-buscar-cpf" class="w-full py-3.5 bg-white text-black font-bold uppercase text-[10px] rounded-xl hover:bg-gray-200 flex items-center justify-center gap-2">
                    <span class="material-icons-outlined text-sm">search</span> Buscar
                </button>
                <div id="resultado-busca-cliente" class="hidden p-4 bg-brand-gray border border-brand-border rounded-xl">
                    <p id="res-cliente-nome" class="text-sm font-bold text-white"></p>
                    <p id="res-cliente-cpf" class="text-[10px] text-gray-500 font-mono mt-0.5"></p>
                    <p id="res-cliente-email" class="text-[10px] text-gray-500 mt-0.5"></p>
                    <button id="btn-vincular-cliente" class="mt-3 w-full py-2.5 bg-white text-black font-bold text-[10px] uppercase rounded-lg hover:bg-gray-200">Vincular</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Gift Card -->
    <div id="modal-cartao-presente" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden items-center justify-center p-4">
        <div class="bg-brand-dark w-full max-w-sm rounded-2xl border border-brand-border shadow-2xl">
            <div class="p-4 bg-brand-black border-b border-brand-border flex justify-between items-center">
                <h3 class="text-white font-bold uppercase tracking-[0.1em] text-xs flex items-center gap-2"><span class="material-icons-outlined text-sm">redeem</span> Cartão Presente</h3>
                <button id="btn-fechar-modal-cartao" class="text-gray-500 hover:text-white"><span class="material-icons-outlined">close</span></button>
            </div>
            <form id="form-cartao-presente" class="p-5 space-y-3">
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">Número (16 dígitos)</label>
                    <input type="text" id="cp-numero" class="input-dark font-mono tracking-widest" placeholder="0000 0000 0000 0000" maxlength="19">
                </div>
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">Código de Segurança</label>
                    <input type="text" id="cp-codigo-seguranca" class="input-dark font-mono tracking-widest" placeholder="0000" maxlength="4">
                </div>
                <button type="submit" class="w-full py-3.5 bg-white text-black font-bold uppercase text-[10px] rounded-xl hover:bg-gray-200">Verificar Saldo</button>
            </form>
        </div>
    </div>

    <!-- Lançamento de Caixa -->
    <div id="modal-lancamento" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden items-center justify-center p-4">
        <div class="bg-brand-dark w-full max-w-sm rounded-2xl border border-brand-border shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-4 bg-brand-black border-b border-brand-border flex justify-between items-center">
                <h3 class="text-white font-bold uppercase tracking-[0.1em] text-xs">Lançamento de Caixa</h3>
                <button id="btn-fechar-lancamento" class="text-gray-500 hover:text-white"><span class="material-icons-outlined">close</span></button>
            </div>
            <form id="form-lancamento" class="p-5 space-y-3 overflow-y-auto">
                <div class="grid grid-cols-2 gap-2">
                    <button type="button" id="lan-btn-entrada" class="py-3 rounded-xl text-[10px] font-bold uppercase tracking-widest border transition-all bg-white text-black border-white">Entrada</button>
                    <button type="button" id="lan-btn-saida" class="py-3 rounded-xl text-[10px] font-bold uppercase tracking-widest border transition-all bg-transparent text-gray-400 border-brand-border">Saída</button>
                </div>
                <input type="hidden" id="lan-tipo" value="entrada">
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">Descrição</label>
                    <input type="text" id="lan-descricao" class="input-dark" placeholder="Ex: Sangria, Suprimento..." required>
                </div>
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">Valor (R$)</label>
                    <input type="number" id="lan-valor" step="0.01" min="0.01" class="input-dark font-mono" placeholder="0.00" required>
                </div>
                <div>
                    <label class="text-[9px] uppercase text-gray-500 block mb-1.5 tracking-widest font-semibold">Forma</label>
                    <select id="lan-forma-pgto" class="input-dark">
                        <option value="dinheiro">Dinheiro</option>
                        <option value="pix">PIX</option>
                        <option value="cartao">Cartão</option>
                    </select>
                </div>
                <button type="submit" class="w-full py-3.5 bg-white text-black font-bold uppercase text-[10px] rounded-xl hover:bg-gray-200">Registrar</button>
            </form>
        </div>
    </div>

    <!-- Modal PIX: QR Code + polling automático -->
    <div id="modal-pix" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden items-center justify-center p-4">
        <div class="bg-brand-dark w-full max-w-sm rounded-2xl border border-brand-border shadow-2xl flex flex-col">
            <div class="p-4 bg-brand-black border-b border-brand-border flex justify-between items-center">
                <h3 class="text-white font-bold uppercase tracking-[0.1em] text-xs flex items-center gap-2">
                    <span class="material-icons-outlined text-sm">qr_code</span> Pagamento PIX
                </h3>
                <button id="btn-fechar-pix" class="text-gray-500 hover:text-white"><span class="material-icons-outlined">close</span></button>
            </div>
            <div class="p-6 flex flex-col items-center gap-4">
                <!-- Loading -->
                <div id="pix-loading" class="flex flex-col items-center gap-2 text-gray-400 py-8">
                    <span class="material-icons-outlined text-3xl animate-spin">sync</span>
                    <p class="text-[11px] uppercase tracking-widest">Gerando cobrança...</p>
                </div>
                <!-- QR + copia e cola -->
                <div id="pix-qr-container" class="hidden flex-col items-center gap-3 w-full">
                    <div class="text-center">
                        <p id="pix-valor-label" class="text-2xl font-mono font-light text-white mb-1"></p>
                        <p class="text-[10px] text-gray-500 uppercase tracking-widest">Aguardando pagamento</p>
                    </div>
                    <img id="pix-qr-img" src="" class="w-48 h-48 rounded-xl border border-brand-border" alt="QR Code PIX">
                    <div class="w-full">
                        <p class="text-[9px] text-gray-500 uppercase tracking-widest text-center mb-1">Copia e Cola</p>
                        <div class="flex gap-2">
                            <input id="pix-copia-cola" type="text" readonly class="input-dark text-[9px] font-mono py-2 flex-1" style="font-size:8px">
                            <button id="btn-copiar-pix" class="shrink-0 px-3 bg-white text-black rounded-xl text-[10px] font-bold uppercase hover:bg-gray-200 transition-colors">Copiar</button>
                        </div>
                    </div>
                    <div id="pix-aguardando" class="flex items-center gap-2 text-[11px] text-yellow-400">
                        <span class="material-icons-outlined text-sm animate-spin">sync</span> Aguardando pagamento...
                    </div>
                    <button id="btn-pix-manual" class="w-full py-2.5 bg-brand-gray border border-gray-600 text-gray-300 font-bold text-[9px] uppercase rounded-xl hover:border-white hover:text-white transition-colors flex items-center justify-center gap-1.5 mt-1">
                        <span class="material-icons-outlined text-sm">done_all</span> Já Recebi — PIX Manual
                    </button>
                    <div id="pix-confirmado" class="hidden flex-col items-center gap-2 text-green-400 w-full text-center">
                        <span class="material-icons-outlined text-5xl">check_circle</span>
                        <p class="text-sm font-bold uppercase tracking-widest">Pago! ✓</p>
                        <button id="btn-fechar-pix-ok" class="mt-2 w-full py-3 bg-white text-black font-bold text-[10px] uppercase rounded-xl hover:bg-gray-200">Fechar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recibo / Cupom Fiscal Térmico -->
    <div id="modal-recibo" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden items-center justify-center p-2 sm:p-4">
        <div class="bg-brand-dark w-full max-w-xs rounded-2xl border border-brand-border shadow-2xl flex flex-col max-h-[95vh]">
            <div class="p-4 border-b border-brand-border flex justify-between items-center bg-brand-black no-print shrink-0">
                <h3 class="text-white font-bold uppercase tracking-[0.1em] text-xs">Cupom Fiscal</h3>
                <button id="btn-fechar-recibo" class="text-gray-500 hover:text-white"><span class="material-icons-outlined">close</span></button>
            </div>
            <div class="flex-1 overflow-y-auto bg-gray-300 flex justify-center p-3">
                <!-- max-width 72mm = largura útil da bobina 80mm -->
                <div id="area-impressao-cupom" class="bg-white text-black shadow" style="width:72mm; min-height:80px;"></div>
            </div>
            <div class="p-3 border-t border-brand-border flex gap-2 bg-brand-black no-print shrink-0">
                <button id="btn-pular-impressao" class="flex-1 py-3 bg-brand-gray border border-brand-border text-white font-bold text-[10px] uppercase rounded-xl hover:bg-brand-border transition-colors">Fechar</button>
                <button id="btn-imprimir-cupom" class="flex-1 py-3 bg-white text-black font-bold text-[10px] uppercase rounded-xl flex items-center justify-center gap-1.5 hover:bg-gray-200 transition-colors">
                    <span class="material-icons-outlined text-sm">print</span> Imprimir
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 bg-white text-black px-5 py-2.5 rounded-full shadow-2xl flex items-center gap-2 transition-all duration-300 -translate-y-20 opacity-0 z-[999] pointer-events-none text-xs font-medium uppercase tracking-widest">
        <span id="toast-icon" class="material-icons-outlined text-sm text-green-600">check_circle</span>
        <span id="toast-msg">ok</span>
    </div>

    <script src="token.js"></script>
    <script src="menu.js"></script>
    <script src="pdv.js"></script>
</body>
</html>
